<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{common/layout/default-layout}"
        layout:fragment="content">
	
	<head>
	    <title>설문 페이지</title>
	    
   	    <!-- inline CSS -->
	    <style th:inline="css" type="text/css">
	        .wrap {
	        	width: 100%;
	        	height:800px;
	        	text-align: center;
	        }
	        .img_wrap {
	        	display: flex;
	        }
			.img_content {
				border: 1px solid black;
				background: #fff;
				width: 250px;
				height: 280px;
				margin-right: 8px;
			}
	    </style>
	
	    <!-- inline JS -->
	    <script th:inline="javascript" type="text/javascript">
			document.addEventListener("DOMContentLoaded", function(){
			});
	
			/* 설문 추가 */
			function addSurvey() {
	
				let form = document.getElementById("productForm");
				
				let formData = new FormData(form);
			
				// formData 값 객체 변환
				let dataInfo = {};
				formData.forEach((value, key) => dataInfo[key] = value);
			
				dataInfo.useAt = document.querySelector('input[name="useAt"]:checked').value;
				
				console.log(dataInfo);	//폼데이터를 객체로 변환
					
				if(confirm("상품을 등록하시겠습니까?")) {
					// 상품등록 진행
					fetch( "/addProduct.do", {
						  method: "post"
						  , headers: {
						    "Content-Type": 'application/json; charset=UTF-8',
						  }
						  , body: JSON.stringify({ dataInfo })
					})
					.then(response => {
						if(response.status == "403" || response.status == "404") {
							alert("오류");
							return;
						}
						if(response.status == "200") {
				 	 		return response.json();
						}
				 	})
					.then(response => {
						console.log(response);
				
						let data = response;
				
						if(data.resultCode == "S") {
							console.log(data.resultMap);
							
							alert("상품 등록이 완료되었습니다!");
							modal1.click()
							selectProductList(); //데이터 리스트 재조회
							
						} else {
							alert(data.resultMsg);
							return;
						}
					})
					.catch(err => {
					      console.log(err);
					});
				};
			}
			
			/* 질문 추가 */
			function addQuestion() {
				let q_tr = document.createElement('tr');
				q_tr.setAttribute('class','q_tr');
				
				q_tr.innerHTML =
		           `
                   <td><input type="text" name="q_content" placeholder="제목 없는 질문" style="width: 100%;"></td>
                   <td>
                   		<select class="q_type" name="q_type">
                   			<option value="">::선택::</option>
                   			<option value="text">단답형</option>
                   			<option value="textarea">장문형</option>
                   			<option value="radio" checked>객관식질문</option>
                   			<option value="checkbox">체크박스</option>
                   			<option value="select">드롭다운</option>
                   		</select>
                   </td>
		           `;
		             
		        (document.getElementById('survey_q_tbody')).appendChild(q_tr);

				 const type = document.getElementsByName('q_type')[0];
				 
				 type.addEventListener('change', (e) => {
				    console.log(e)
				   	if(!type.value) {
						 return;
					} else {
					    addAnswer(type.value, e);
					}
				 });
			}

			
			function addAnswer(type, e) {
				console.log(e);
				const closestQ = e.currentTarget.closest('.q_type');
// 				closestQ.innerHTML = '';
				
				let a_tr = document.createElement('tr');
				a_tr.setAttribute('class','a_tr');
				
	           	if(type == "text" || type == "radio" || type == "checkbox"){
	        	   a_tr.innerHTML = '<td><input type="' + type + '">옵션</td>';
	               
	               if(type != "text") {
	            	   a_tr.innerHTML =
		            	   `<td><input type="` + type + `">옵션</td><td id="addOption">
		                   <button id="btn_addOption" class="btn btn-sm btn-minus rounded-circle bg-light border" onclick="addOption();">
		                   		<i class="fa fa-plus"></i>
		                   </button>
                   		</td> `;
		           }
	               
		       	} else if(type == "select") {
		    	   a_tr.innerHTML = '<td><' + type + '><option value="">:: 선택 ::</option></' + type + '></td>';
		       	} else {
		    	   a_tr.innerHTML = '<td><' + type + ' style="resize:none; width: 500px; height: 80px;"></' + type + '></td>';
			   	}

		        (document.getElementById('survey_q_tbody')).appendChild(a_tr);
			}

			function addOption() {
				let a_tr = document.createElement('tr');
		             
				a_tr.innerHTML =
		           `
                   <td>
                   		<input type="radio">옵션
                   </td>
                   <td id="addOption">
	                   <button id="btn_addOption" class="btn btn-sm btn-minus rounded-circle bg-light border" onclick="addOption();">
	                   		<i class="fa fa-plus"></i>
	                   </button>
                   </td>
		           `;
		           
		        document.querySelectorAll('#btn_addOption')[0].remove();
		        
		        (document.getElementById('survey_q_tbody')).appendChild(a_tr);
			}
	    </script>
	</head>

    <body>
        <!-- Spinner Start -->
        <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->
        
		<!-- Single Page Header start -->
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">ADD SURVEY</h1>
<!--             <ol class="breadcrumb justify-content-center mb-0"> -->
<!--                 <li class="breadcrumb-item"><a href="#">Home</a></li> -->
<!--                 <li class="breadcrumb-item"><a href="#">Pages</a></li> -->
<!--                 <li class="breadcrumb-item active text-white">Cart</li> -->
<!--             </ol> -->
        </div>
        <!-- Single Page Header End -->

        <!-- Page Start -->
        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="table-responsive">
                    <table id="survey_tbl" class="table">
                        <tbody>
							<tr>
							  	<th scope="col">TITLE</th>
                              	<td><input type="text" id="title" style=""></td>
							</tr>
                            <tr>
                            	<th scope="col">DATE</th>
                                <td><input type="text" id="start_dt">~<input type="text" id="end_dt"></td>
                            </tr>
                        </tbody>
                    </table>
                 	<div class="input-group-btn">
                        <button class="btn btn-sm btn-minus rounded-circle bg-light border" onclick="addQuestion();" style="float: right;">
                        	<i class="fa fa-plus"></i>
                        </button>
                    </div>
                    <table id="survey_q_tbl" class="table">
                        <tbody id="survey_q_tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Page End -->
    </body>

</html>